<%= month_calendar(events: @epochs) do |date, epochs| %>
  <div class="calendar calendar-month card shadow bg-gradient-secondary">
    <div class="card-header position-relative px-2">
      <time datetime="<%= date %>" class="font-monospace"><%= l(date, format: :short) %></time>
      <div class="clipboard" data-controller="clipboard" data-clipboard-success-content-value="Copied!">
        <span class="d-none visually-hidden" data-clipboard-target="source"><%= request.original_url.split("#").first + "##{date}" %></span>
        <a href="#<%= date %>" data-action="clipboard#copy" data-clipboard-target="button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75"></path>
          </svg>
        </a>
      </div>
    </div>

    <ul class="list-group list-group-flush">
      <% epochs.each_with_index do |epoch, idx| %>
        <%= tag.li class: "list-group-item position-relative p-2", data: { start_time: epoch.start_time.to_i, end_time: epoch.end_time.to_i } do %>
          <% if idx > 0 %>
            <i class="bi bi-chevron-double-down epoch-transition position-absolute start-50 top-0 bg-body translate-middle px-3"></i>
          <% end %>

          <div>
            <%= epoch.name %>
            <a href="javascript:void()" class="ms-1" data-controller="popper" data-popper-target="popover" data-bs-title="<%= epoch.name %>" data-bs-content="<%= epoch_description(epoch, time_range: true, slot: false) %>">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
              </svg>
            </a>
          </div>

          <ul class="list-group list-group-flush">
            <% epoch.events.select { |e| (e.start_time.to_date..e.end_time.to_date).include?(date) }.each do |event| %>
              <li class="event list-group-item px-0 py-3">
                <small>
                  <div>
                    <time class="me-1 text-muted font-monospace"><%= event_time(event) %></time>
                    <%= tags(event) %>
                  </div>
                  <span><%= event.name %></span>
                </small>

                <% unless event.description.blank? %>
                  <%= link_to event_path(name: event.urlname, id: event.id), class: "ps-1", data: { turbo_stream: true } do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                      <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    </ul>

  </div>
<% end %>